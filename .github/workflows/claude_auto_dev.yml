name: Claude Auto-Dev Agent

on:
  issues:
    types: [labeled]
  pull_request:
    types: [labeled]

jobs:
  prd-draft:
    if: github.event.label.name == 'action:prd-draft'
    runs-on: self-hosted

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Claude PRD Draft
        shell: zsh {0}
        run: |
          source ~/.zshrc
          
          export PATH=$PATH:/opt/homebrew/bin:/usr/local/bin
          ISSUE_NUMBER=${{ github.event.issue.number }}
          
          claude -p "@.claude/prd_draft_instructions.md Handle GitHub Issue #$ISSUE_NUMBER" \
            --permission-mode bypassPermissions < /dev/null
  prd-development:
    if: github.event.label.name == 'action:implement'
    runs-on: self-hosted

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Claude PRD Implement
        shell: zsh {0}
        run: |
          source ~/.zshrc
          
          export PATH=$PATH:/opt/homebrew/bin:/usr/local/bin
          ISSUE_NUMBER=${{ github.event.issue.number }}
          
          claude -p "@.claude/prd_implement_instructions.md Handle GitHub Issue #$ISSUE_NUMBER" \
            --permission-mode bypassPermissions < /dev/null