name: Claude Auto-Dev Agent

on:
  issues:
    types: [labeled]

jobs:
  # PRD åŠŸèƒ½å¼€å‘
  prd-development:
    if: github.event.label.name == 'gsd:prd'
    runs-on: self-hosted

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Claude PRD Development
        shell: zsh {0}
        run: |
          # åŠ è½½ zsh é…ç½®ä»¥è·å–ç¯å¢ƒå˜é‡
          source ~/.zshrc
          
          export PATH=$PATH:/opt/homebrew/bin:/usr/local/bin
          
          ISSUE_NUMBER=${{ github.event.issue.number }}
          
          echo "ğŸš€ Starting PRD development for Issue #$ISSUE_NUMBER"
          echo "ğŸ“‚ Working directory: $(pwd)"
          echo "ğŸ“‹ Files available:"
          ls -la | head -20
          
          # è®© Claude è‡ªä¸»å®Œæˆæ•´ä¸ªå¼€å‘æµç¨‹
          claude -p "@.claude/prd_instructions.md Handle GitHub Issue #$ISSUE_NUMBER"

  # Bug ä¿®å¤
  bugfix:
    if: github.event.label.name == 'gsd:bugfix'
    runs-on: self-hosted

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Claude Bug Fix
        shell: zsh {0}
        run: |
          # åŠ è½½ zsh é…ç½®ä»¥è·å–ç¯å¢ƒå˜é‡
          source ~/.zshrc
          
          export PATH=$PATH:/opt/homebrew/bin:/usr/local/bin
          
          ISSUE_NUMBER=${{ github.event.issue.number }}
          
          echo "ğŸ› Starting bug fix for Issue #$ISSUE_NUMBER"
          echo "ğŸ“‚ Working directory: $(pwd)"
          echo "ğŸ“‹ Files available:"
          ls -la | head -20
          
          # è®© Claude è‡ªä¸»å®Œæˆæ•´ä¸ªä¿®å¤æµç¨‹
          claude -p "@.claude/bugfix_instructions.md Handle GitHub Issue #$ISSUE_NUMBER"